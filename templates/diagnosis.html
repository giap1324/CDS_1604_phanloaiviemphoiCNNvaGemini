{% extends "base.html" %}

{% block title %}Chi ti·∫øt ch·∫©n ƒëo√°n #{{ diagnosis.id }}{% endblock %}

{% block content %}
<div class="diagnosis-detail">
    <h2>Chi ti·∫øt ch·∫©n ƒëo√°n #{{ diagnosis.id }}</h2>
    
    <div class="detail-card">
        <div class="detail-section">
            <h3>K·∫øt qu·∫£</h3>
            <div class="result-display">
                <span class="prediction-badge large {% if diagnosis.prediction == 'NORMAL' %}normal{% else %}pneumonia{% endif %}">
                    {{ diagnosis.prediction }}
                </span>
                <p class="confidence-large">ƒê·ªô tin c·∫≠y: <strong>{{ diagnosis.confidence|round(2) }}%</strong></p>
            </div>
        </div>
        
        <div class="detail-section">
            <h3>Th√¥ng tin file</h3>
            <p><strong>T√™n file:</strong> {{ diagnosis.filename }}</p>
            <p><strong>Th·ªùi gian:</strong> {{ diagnosis.timestamp.strftime('%d/%m/%Y %H:%M:%S') }}</p>
        </div>
        
        <div class="detail-section">
            <h3>·∫¢nh X-quang</h3>
            <div class="image-container">
                <img src="{{ url_for('uploaded_file', filename=diagnosis.filename) }}" 
                     alt="X-ray image" 
                     onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27224%27 height=%27224%27%3E%3Ctext x=%2750%25%27 y=%2750%25%27 text-anchor=%27middle%27%3E·∫¢nh kh√¥ng t√¨m th·∫•y%3C/text%3E%3C/svg%3E'">
            </div>
        </div>
        
        {% if diagnosis.medical_report %}
        <div class="detail-section medical-report-section">
            <h3>üìã B√°o c√°o y khoa t·ª± ƒë·ªông (Gemini AI)</h3>
            <div class="medical-report-box">
                <div class="report-timestamp">
                    <small>ƒê∆∞·ª£c t·∫°o l√∫c: {{ diagnosis.report_generated_at.strftime('%d/%m/%Y %H:%M:%S') if diagnosis.report_generated_at else 'N/A' }}</small>
                </div>
                <div class="report-content">
                    {{ diagnosis.medical_report|format_medical_report|safe }}
                </div>
            </div>
        </div>
        {% endif %}
        
        <div class="disclaimer-box">
            <p><strong>‚ö†Ô∏è L∆∞u √Ω:</strong> K·∫øt qu·∫£ n√†y ch·ªâ mang t√≠nh ch·∫•t tham kh·∫£o. Vui l√≤ng tham kh·∫£o √Ω ki·∫øn b√°c sƒ© chuy√™n khoa ƒë·ªÉ c√≥ ch·∫©n ƒëo√°n ch√≠nh x√°c v√† ƒëi·ªÅu tr·ªã ph√π h·ª£p.</p>
        </div>
    </div>
    
    <div class="action-buttons">
        <a href="{{ url_for('history') }}" class="btn btn-secondary">Quay l·∫°i l·ªãch s·ª≠</a>
        <a href="{{ url_for('index') }}" class="btn btn-primary">Ch·∫©n ƒëo√°n m·ªõi</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
{% endblock %}

